(function(f){var l,b,k,c,i,h,g,d,j,e,m,a;a={defTag:"abbr",attrKey:"data-definition",attrDef:"title",addClass:"definition",includeWord:"true",onComplete:null};f.fn.autoabbr=function(n){var o=this;f.extend(a,n);l={};if(a.words){l=a.words}if(a.src){f.get(a.src,function(p){f.extend(l,p);k(o)},"json")}else{k(o)}};k=function(n){d();i(n);if(typeof a.onComplete==="function"){a.onComplete.call(n)}};d=function(){var o={};for(var n in l){if(l.hasOwnProperty(n)){j(n,o,0)}}g=o};j=function(r,q,n){var o=q[r[n]]||{};if(r[n+1]){j(r,o,n+1)}else{o.word=true}q[r[n]]=o};i=function(r){var p,n;var o,q;o=r.children();for(p=0,n=o.length;p<n;p++){i(f(o[p]))}q=r.contents();for(p=0,n=q.length;p<n;p++){if(q[p].nodeType===3){c(q[p])}}};c=function(o){var s,r,p;var u=[];var v=o.nodeValue;var q=g;var n="";var t="";for(s=0,r=v.length;s<r;s++){p=v[s].toLowerCase();if(q.hasOwnProperty(p)){q=q[p];n+=p}else{if(p.match(/^\W$/)){if(q.word){u.push({i:s,word:n,key:t||n})}t="";n="";q=g}else{if(q.hasOwnProperty("*")){q={"*":true,word:true};if(!t){t=n+"*"}n+=p}else{q={}}}}}if(q.word){u.push({i:s,word:n,key:t||n})}if(u.length){b(o,u)}};b=function(n,v){var p,s,o,r,q;var t=[];var u=0;var w=n.nodeValue;for(r=0,q=v.length;r<q;r++){p=v[r];t.push({type:"text",text:w.slice(u,p.i-p.word.length)});t.push({type:"word",text:w.slice(p.i-p.word.length,p.i),word:p.key});u=p.i}t.push({type:"text",text:w.slice(u)});s=n.parentNode;s.removeChild(n);for(r=0,q=t.length;r<q;r++){o=m(t[r]);if(o!==null){s.appendChild(o)}}};m=function(n){var o,p;if(!n.text||n.text.length===0){return null}if(n.word){o=document.createElement(a.defTag);o.innerHTML=n.text;if(a.attrDef){p=l[n.word];if(a.includeWord){p=n.text+": "+p}o.setAttribute(a.attrDef,p)}if(a.attrKey){o.setAttribute(a.attrKey,n.word)}if(a.addClass){o.className=a.addClass}}else{o=document.createTextNode(n.text)}return o}})(jQuery);